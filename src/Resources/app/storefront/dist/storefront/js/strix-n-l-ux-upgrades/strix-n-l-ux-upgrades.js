(()=>{"use strict";class t extends window.PluginBaseClass{static #t=this.options={removeProductTriggerSelector:".js-offcanvas-cart-remove-product",removeButtonSelector:".line-item-remove-button",trashButtonSelector:'button[formaction*="/checkout/line-item/delete/"]',quantitySelectSelector:".js-offcanvas-cart-change-quantity",quantityInputSelector:".js-offcanvas-cart-change-quantity-number",cartItemSelector:".js-cart-item",cartItemsContainerSelector:".offcanvas-cart-items"};init(){this._registerEvents()}_registerEvents(){this.el.querySelectorAll(this.options.removeProductTriggerSelector).forEach(t=>{t.addEventListener("submit",this._onRemoveProductFromCart.bind(this))});let t=this.el.querySelectorAll(this.options.removeButtonSelector),e=this.el.querySelectorAll(this.options.trashButtonSelector),o=this.el.querySelectorAll(this.options.quantitySelectSelector),r=this.el.querySelectorAll(this.options.quantityInputSelector);t.forEach(t=>{t.addEventListener("click",this._onRemoveButtonClick.bind(this))}),e.forEach(t=>{t.addEventListener("click",this._onTrashButtonClick.bind(this))}),o.forEach(t=>{t.addEventListener("change",this._onQuantityChange.bind(this))}),r.forEach(t=>{t.addEventListener("change",this._onQuantityChange.bind(this))})}_onRemoveProductFromCart(t){t.preventDefault(),t.stopPropagation();let e=t.target;this._submitFormAjax(e)}_onRemoveButtonClick(t){t.preventDefault(),t.stopPropagation();let e=t.currentTarget.closest("form");this._submitFormAjax(e)}_onTrashButtonClick(t){t.preventDefault(),t.stopPropagation();let e=t.currentTarget,o=e.closest("form"),r=e.getAttribute("formaction");this._submitFormAjax(o,r)}_onQuantityChange(t){t.preventDefault(),t.stopPropagation();let e=t.currentTarget.closest("form");this._submitFormAjax(e)}async _submitFormAjax(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=new FormData(t);o.append("redirectTo","frontend.cart.offcanvas");let r=e||t.action;try{let e=await fetch(r,{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest"}});if(e.ok){let t=await e.text(),o=document.querySelector(".offcanvas");o&&(o.innerHTML=t,window.PluginManager.initializePlugins(),window.PluginManager.getPluginInstances("CartWidget").forEach(t=>t.fetch()))}else t.submit()}catch(e){t.submit()}}}window.PluginManager.register("CartFlyoutPlugin",t,".offcanvas-cart")})();